<!DOCTYPE html>
<html>
    <head>
        <link href="static/styles.css" rel="stylesheet" type="text/css">

        <script src="lib/pubnub-3.7.15.min.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
        <script src="https://fb.me/react-0.14.0.js"></script>
        <script src="https://fb.me/react-dom-0.14.0.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.js"></script>
        
        <title>MultiVS</title>
    </head>
   <body>
        <div id="stage"></div>
        
        <script type="text/babel">
            var Settings = React.createClass({
                getInitialState: function() {
                    return { channel: Math.random().toString(36).substring(7) }
                },
                handleSubmit: function(e) {
                    e.preventDefault();
                    var channel = this.refs.channel.value.trim();
                    this.props.onJoinChannel(channel);
                },
                render: function() {
                    return (
                        <div className="settings">
                            <form className="joinForm" onSubmit={this.handleSubmit}>
                                Channel: <input type="text" ref="channel" defaultValue={this.state.channel} />
                                <input type="submit" value="Join!" />
                            </form>
                        </div>
                    );
                }
            });
            
            var Rightpanel = React.createClass({
                render: function() {
                    return (
                        <div className="rightpanel">
                            <Scoreboard />
                            <Chat />
                        </div>
                    );
                }
            });
            
            var Scoreboard = React.createClass({
                render: function() {
                    return (
                        <div className="scoreboard">
                            Scoreboard!
                        </div>
                    );
                }
            });
            
            var Chat = React.createClass({
                render: function() {
                    return (
                        <div className="chat">
                            Chat!
                        </div>
                    );
                }
            });
            
            var MultiVS = React.createClass({
                getInitialState: function() {
                    return {
                        pubnub: PUBNUB({
                            subscribe_key: 'sub-d42094ba-22dd-11e2-9d54-8be12a68240a',
                            publish_key: 'pub-d5abc57f-7dea-4275-9253-18305c0f27e1'
                        })
                    }
                },
                render: function() {
                    return (
                        <div className="multivs">
                            <Settings onJoinChannel={this.joinChannel} />
                            <Rightpanel />
                        </div>
                    );
                },
                joinChannel: function(channel) {
                    this.state.pubnub.subscribe({
                        channel: channel,
                        message: function(m){console.log(m)},
                        error: function (error) {
                            console.log(JSON.stringify(error));
                        }
                    });
                }
            });

            ReactDOM.render(
                <MultiVS />,
                document.getElementById('stage')
            );
        </script>
   </body>
</html>